---
import { COMMENT_CONFIG } from '~/config'

interface Props {
  id: string
  title: string
}

const { id, title } = Astro.props
const { enabled, system } = COMMENT_CONFIG

if (!enabled || system === 'none') {
  return null
}
---

<div class="comment-container mt-8 pt-8 border-t border-gray-200 dark:border-gray-700">
  <h3 class="text-xl font-semibold mb-6 text-gray-900 dark:text-gray-100">评论</h3>

  {system === 'gitalk' && <div id="gitalk-container" data-id={id} data-title={title} />}
</div>

<script>
  import { COMMENT_CONFIG } from '~/config'
  const { system, gitalk } = COMMENT_CONFIG
  console.log(gitalk)
  if (system === 'gitalk' && gitalk) {
    import('gitalk/dist/gitalk.css')
    import('gitalk').then(({ default: Gitalk }) => {
      const gitalkComment = new Gitalk({
        clientID: gitalk.clientID,
        clientSecret: gitalk.clientSecret,
        repo: gitalk.repo,
        owner: gitalk.owner,
        admin: gitalk.admin,
        language: gitalk.language || 'zh-CN',
        perPage: gitalk.perPage || 10,
        pagerDirection: gitalk.pagerDirection || 'last',
        createIssueManually: gitalk.createIssueManually || false,
        distractionFreeMode: gitalk.distractionFreeMode || false,
        enableHotKey: gitalk.enableHotKey !== false,
        id: document.getElementById('gitalk-container')?.dataset.id || '',
        title: document.getElementById('gitalk-container')?.dataset.title || '',
      })
      gitalkComment.render('gitalk-container')
    })
  }
</script>
